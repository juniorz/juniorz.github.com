---
layout: post
title: "Configurando o modem 3G Huwaei E173s (Vivo) no Linux"
date: 2011-05-03
comments: false
categories:
 - linux
---

<div class='post'>
<b>Cenário:</b> Uma máquina com vários dispositivos USB sendo um deles, um modem 3G E173s fornecido pela Vivo (o modem branquinho). Como automatizar a instalação do modem USB e a conexão com a internet?<br /><br /><b>Primeira opção:</b> Instalar o próprio programa da Vivo. Essa alternativa automatiza os procedimentos e é recomendável se você vai utilizar um ambiente de desktop (Gnome, Kde, etc) para acesso à internet. Não é o meu caso.<br /><br /><b>Segunda opção:</b> Configurar tudo na mão. O principal problema é que não poso ter certeza que o modem sempre vai estar no mesmo device file. Às vezes ele fica em /dev/ttyUSB0 às vezes em /dev/ttyUSB1. Isso acontece porque eu tenho outros dispositivos que também são USB serial. Além disso, ao conectar o modem ele aparece primeiro como um CD-ROM e depois que se isntala o programa da Vivo é que ele va iser reconhecido como um modem.<br /><br /><h3>Configurando tudo na mão</h3><br /><b>1) Descobrir informações sobre o Hardware</b><br />Vai ser preciso saber informações sobre o dispositivo USB. Essas informações fazem parte do próprio padrão USB. Cada dispositivo tem, por exemplo, um <i>Product Id</i> e um <i>Vendor Id</i> entre outras informações. Isso vai ser útil para criar as regras udev que vamos utilizar.<br /><br /><blockquote style="font-family: &quot;Courier New&quot;,Courier,monospace;">$ udevadm info -q path -n /dev/ttyUSB1<br />$ /devices/pci0000:00/0000:00:1d.7/usb1/1-4/1-4.4/1-4.4.1/1-4.4.1:1.0/ttyUSB1/tty/ttyUSB1<br /><br />$ udevadm info -a -p /devices/pci0000:00/0000:00:1d.7/usb1/1-4/1-4.4/1-4.4.1/1-4.4.1:1.0/ttyUSB1/tty/ttyUSB1<br />[...]</blockquote><br /><b>2) Configurar o usb_modeswitch</b><br />Seguindo as <a href="http://www.taginfo.com.br/s1/index.php?option=com_content&amp;view=article&amp;id=95:instalar-o-modem-huawei-e173-no-ubuntu-10&amp;catid=6:ti&amp;Itemid=8">informações obtidas em um outro blog</a>, isso foi muito fácil. Agora o modem já vai ser reconhecido como modem (e não mais como CD-ROM) ao plugado na máquina.<br /><br /><b>3) Criar o link simbólico para o modem</b><br />Para utilizar outros programas para conectar (por exemplo wvdial, pon ou pon.wvdial) eu preciso colocar no arquivo de configuração um device file que não mude. Por isso eu vou criar um link /dev/modem de maneira dinâmica apontando para qual /dev/ttyUSB* o modem estiver.<br /><br />Crie um arquivo adicional de regras udev<br /><blockquote style="font-family: &quot;Courier New&quot;,Courier,monospace;">sudo vim /etc/udev/rules.d/80-huwaei_e173s.rules</blockquote><br />Nele coloque uma regra que vai criar o link simbólico. Para mais informações em como modificar essa regra, dê uma olhada nessa ótima <a href="http://www.reactivated.net/writing_udev_rules.html">explicação sobre regras udev</a>. Vale ressaltar que a parte inicial da regra foi obtida por meio do passo 1.<br /><blockquote style="font-family: &quot;Courier New&quot;,Courier,monospace;">#Huawei E173s (Modem mesmo)<br />SUBSYSTEMS=="usb", DRIVERS=="option", ATTRS{bInterfaceNumber}=="00", SYMLINK+="modem" OWNER="root" GROUP="dialout" MODE="0777"</blockquote><br />Feito isso o modem pode ser acessado pelo link <b>/dev/modem</b>. Em seguida é só configurar o utilitário de discagem de sua preferência (no meu caso foi o wvdial)<br /><br />4) Profit!</div>
